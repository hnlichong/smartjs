<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>动画</title>
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <script src="http://cdn.visionape.cn/js/jquery.1102.min.js"></script>
    <script type="text/javascript" src="../build/smartjs.js"></script>


</head>

<body>

<img id="avatar" cropwidth="100" alt="" cropheight="100" src=""/>
<input type="file" hidden="hidden" id="localimage" onchange="preImg(this.id,'imgPre');"/>

<div id="_box">选择图片</div>

<script type="text/javascript">

    SmartJS.FastClick('body');



    var img = $('#avatar_crop');
    function preImg(file) {
        if (typeof FileReader === 'undefined') {
            alert('Your browser does not support FileReader...');
            return;
        }
        var reader = new FileReader();
        reader.onload = function (e) {
            img.attr('src', this.result);
        };
        reader.readAsDataURL(file);
    }


    var fileButton=new SmartJS.FileButton('#_box');
    fileButton.file.attr('name','filename')
    uploadDIR='upload_avatar'


    fileButton.addEventListener('change',function(e){

        preImg(e.file)
    });

    $(fileButton.file).ajaxFileUpload({
        url: uploadDIR,
        dataType: 'json',
        autoUpload: true,
        onSuccess: function (data, files, xhr) {
            //  $($($updata).attr('input')).val(JSON.parse(data).url);
            console.log(button.attr('id'))
            console.log(nf.attr('name'));
            console.log(button.attr('id'));
            //addImage(JSON.parse(data).url);
            nf.val(JSON.parse(data).url);

        }
    });





</script>

</body>
